// Firebase Firestore Security Rules
// Copy these rules to Firebase Console → Firestore Database → Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function: Check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Helper function: Check if user owns the document
    function isOwner(userId) {
      return request.auth.uid == userId;
    }
    
    // Users collection
    match /users/{userId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated() && isOwner(userId);
      allow update, delete: if isAuthenticated() && isOwner(userId);
    }
    
    // Customers collection
    match /customers/{customerId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAuthenticated();
    }
    
    // Customer Profiles collection
    match /customerProfiles/{profileId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAuthenticated();
    }
    
    // Customer Notes collection
    match /customerNotes/{noteId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAuthenticated();
    }
    
    // Migration Opportunities collection
    match /migrationOpportunities/{opportunityId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAuthenticated();
    }
    
    // Contacts collections
    match /customerContacts/{contactId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAuthenticated();
    }
    
    match /internalContacts/{contactId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAuthenticated();
    }
    
    // Products collection
    match /products/{productId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAuthenticated();
    }
    
    // Partners collection
    match /partners/{partnerId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAuthenticated();
    }
  }
}

// IMPORTANT NOTES:
// 
// 1. These rules require authentication:
//    - Users must sign in with Google before accessing data
//    - Provides basic security for your application
//
// 2. For development/testing, you can use simpler rules:
//    match /{document=**} {
//      allow read, write: if request.auth != null;
//    }
//
// 3. For production, consider adding:
//    - Field validation
//    - Rate limiting
//    - More granular permissions
//    - Data validation rules
//
// 4. To apply these rules:
//    a. Go to Firebase Console
//    b. Navigate to Firestore Database → Rules
//    c. Copy and paste these rules
//    d. Click "Publish"
//
// 5. Test your rules:
//    - Use Firebase Console → Rules → Simulator
//    - Test different scenarios before publishing
